version: "2"
sql:
  - engine: postgresql
    queries:
      - sqlc/users.sql
    schema: structure.sql
    database:
      uri: "postgresql://{{ .SchemaName }}_app@localhost:5432/{{ .SchemaName }}"
    gen:
      go:
        package: sqlc
        out: ../internal/postgres/sqlc
        sql_package: "pgx/v5"
        emit_interface: true
        emit_prepared_queries: true
        emit_db_tags: true
        overrides:
          - db_type: "uuid"
            go_type:
              import: "github.com/google/uuid"
              type: "UUID"
    rules:
      - postgresql-query-too-costly
      - postgresql-no-seq-scan

rules:
  - name: postgresql-query-too-costly
    message: "Query cost estimate is too high"
    rule: "postgresql.explain.plan.total_cost > 25.0"
  - name: postgresql-no-seq-scan
    message: "Query plan results in a sequential scan"
    rule: "postgresql.explain.plan.node_type == 'Seq Scan'"
