# Connecting to RDS

## Authentication

RDS uses IAM-based authentication, which requires a fresh token to access the database. 

**Important**: The token expires after 15 minutes, so you'll need to refresh it every 15 minutes.

## How to access RDS with psql

Use the following command to connect with IAM authentication:

```bash
psql "host=<db_host> port=5432 dbname={{ .SchemaName }} user={{ .SchemaName }}_readonly password=$(aws rds generate-db-auth-token --hostname <db_host> --port 5432 --region us-east-1 --username {{ .SchemaName }}_readonly) sslmode=require"
```

## How to access RDS with DBeaver

![DBeaver Connection Settings](images/dbeaver.png)

Enter host, username and password in the connection config screen. Note that password is token generated by AWS CLI with the following command:

```bash
aws rds generate-db-auth-token --hostname <db_host> --port 5432 --region us-east-1 --username {{ .SchemaName }}_readonly
```

**Important**: Be sure to check "Save password" in the connection config screen. Otherwise, the connection will fail (shrug).
